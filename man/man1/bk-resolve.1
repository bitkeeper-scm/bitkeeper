.so ../bk-macros
.TH "bk resolve" 1 20%E% "\*(BC" "\*(UM"
.\"    ============== BitKeeper resolve ==============
.SH NAME
bk resolve \- merge and/or apply new work after push/pull
.SH SYNOPSIS
.\" -F undoc
.Bc bk resolve [\-aAcdlnqrtv1234] [
.OPTreq \-l log
.Bc ] [
.OPTreq \-m merge
.Bc ] [
.OPTreq \-X glob
.Bc ] [
.OPTreq \-y comment
.Bc ] [
.ARGc package_root
.Bc ] [
.ARGc globs
.B ]
.SH DESCRIPTION
.LP
After a 
.BR bk\ push , 
or 
.BR bk\ pull , 
use resolve to merge and/or apply
new work.  Resolve is automatically run by the 
.B bk pull
and
.B bk push
commands, but you may quit the resolver and re-run it at a later time.
.LP
If you want to preview the new changesets before merging, you can run
.B bk csets 
and that will run csettool on the list of changes (which can
be found in RESYNC/BitKeeper/etc/csets).
.LP
Resolve traverses all of the files, prompting you with a list of files
needing to be merged.  The following are the stages when resolving files:
.TP .4i
.B \*(BU
create and rename conflicts
.tp
.B \*(BU
mode conflicts (file permissions)
.tp
.B \*(BU
file flag conflicts
.tp
.B \*(BU
file content conflicts
.tp
.B \*(BU
symbol "conflicts" (local and remote added the "alpha" symbol to
different deltas)
.LP
When there are no conflicts left to be merged, resolve groups any merge
changes into a changeset and moves everything into your repository.
If you have specified specific files to resolve on the command
line, or if you used the \-X option, the changeset will not be
created.  You must run resolve without any of these options to create
the changeset.
.LP
When using the glob patterns, the pattern must match the full pathname,
not just the filename part.  For example, given a filename of src/bk.c
the patterns '*bk.c' or 'src/*.c' would match, whereas 'bk.c' would not.
.LP
While it is OK to quit out of resolve without finishing, the repository
will be locked and remain locked until you return to resolve and finish
up the merge process.
.LP
For detailed help on the merge process, see 
.BR bk\ help\ merging .
.SH PASSES
.LP
The resolver has four passes (phases), each with a different function.
A given pass must be completed before the next pass can be started.
Using options listed below, the user can specify which passes are
to be run on a particular invocation of the resolver.  By default,
the resolver attempts to complete all four passes.
.LP
The first pass looks through both the incoming and local changes to see
if any files have been renamed.  If there are files that have been
renamed, they are marked and put in a special BK-managed namespace where
they await rename processing.
.LP
In the second pass, the files marked and saved in pass 1 are inspected
to see if there are any rename conflicts.  That is, if a file was
renamed in both the local and remote repositories with a different
pathname in each.  If this is the case, the user is prompted to resolve
the conflict.  In the other cases, the resolver can infer the correct
pathname and relocates the file out of the special BK-managed namespace
and into the proper place in the resolver working directory (usually
named RESYNC).
.LP
The third pass examines all files looking for content conflicts.
Content conflicts arise when either the contents, symbolic link
destination, or file modes have been changed both in the local and
remote repositories.  These changes can be automatically resolved
without user input as long as the changes don't overlap.  In the case
where automatic resolution is unsuccessful, the user is prompted to
resolve the conflict manually.
.LP
After all the conflicts have been resolved, the fourth pass attempts
to apply the changes to the local repository by moving the files out
of the resolver working directory and into the local repository.  If
this cannot be completed for some reason (permission problems, modified
files in the local repository, etc.), the operation is aborted.  Any
changes made to the local repository are removed, and the resolver
working directory is left intact.  The user can then fix the problems
that caused the error, then re-run the resolver to apply the changes
to the local repository.
.SH OPTIONS
.if t .TP .8i
.if n .TP 1i
.B \-1
Run only pass 1; similarly for 2 3 and 4.
.tp
.B \-a
Automerge.  This will run a diff3\-based merge of
all non\-overlapping lines.  If there are overlapping
lines in merged files, the merge will fail and the files
will not be resolved; you have to run resolve again
without the 
.B \-a
option to finish the resolve.
.tp
.B \-A
Auto advance.  Normally, when doing an interactive resolve,
the resolution is not complete until you tell the system
to commit the file ("C" in the content resolve menu).  This
allows for several false starts on a merge, you can use
"m" to merge, decide that you didn't like it, and use
"m" again to try over.  If 
.B \-A
is used, any sort of merge
which completes is immediately used and the resolver 
advances to the next file.
.tp
.B \-c
No conflicts.  This option tells resolve to complete if and
only if new non\-conflicting work appears in the patch.
.tp
.B \-d
Debugging (mainly useful to \*(BK developers).
.tp
.tp
.OPTreq \-l log
Log operations to 
.ARG log
(or stderr if no destination is specified).
This option is to provide for audit trails; support is not
yet complete.
.tp
.OPTreq \-m merge
Use 
.ARG merge
as the merge program called when you press "m"
in the content resolver.  The merge program takes four file
arguments: the local version of the file, the ancestor
version of the file, the remote version of the file,
and the merged file.  It is the job of the merge program
to merge the changes into the merge file. 
.tp
.B \-q
Be quiet.
.tp
.B \-r
Re\-merge.  If you started to resolve, exited the resolver,
and then restarted, files already merged will be skipped.
This options allows you to re\-merge files which need
help, yet allows you to skip past the ones you are happy
with by hitting "C" in the resolve menu.
.tp
.B \-t
Text\-only. Enables the text\-based resolve menu when doing 
the final commit instead of using citool.
.tp
.OPTreq \-X glob
Exclude (don't resolve) file matching the glob pattern specified.  This
option may be specified multiple times.
.tp
.OPTreq \-y comment
Use 
.ARG comment
as the changeset check\-in message.  This option
is typically set by the calling program, i.e., 
.BR bk\ pull .
If 
.ARG comment
is not present, resolve will prompt for one
at commit time.
.SH "SEE ALSO"
.SA csets 1
.SA merging 1
.SA pull 1
.SA push 1
.SA conflicts 1
.SH CATEGORY
.B Repository
